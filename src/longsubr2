#!/bin/bash
longsubr2() {
    domains_file="$1"
    prefixlist="$BFH_PATH/TXT/smart_alfa5"  # 5-letter combos only
    outputfile="all_subs_longbr2_results.txt"

    if [ ! -f "$domains_file" ]; then
        echo "Usage: longsubr2 <file_with_domains>"
        return 1
    fi

    if [ ! -f "$prefixlist" ]; then
        echo "[!] Missing $prefixlist â€” generate it first!"
        return 1
    fi

    # reset output
    > "$outputfile"
    sublist=$(mktemp)

    echo "[*] Preparing all subdomains..."
    while read -r domain; do
        [ -z "$domain" ] && continue
        echo "[*] Adding prefixes for $domain..."
        while read -r prefix; do
            echo "${prefix}.${domain}" >> "$sublist"
        done < "$prefixlist"
    done < "$domains_file"

    echo "[*] Total subdomains to check: $(wc -l < "$sublist")"
    echo "[*] Running dnsx..."
    dnsx -l "$sublist" -silent | tee "$outputfile"

    echo "[+] All results saved in $outputfile"
    rm -f "$sublist"
}
